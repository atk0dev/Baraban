var module=angular.module("moderateIndex",[]);module.config(["$routeProvider",function(n){n.when("/",{controller:"groupsController",templateUrl:"/templates/groupsView.html"});n.when("/newgroup",{controller:"newGroupController",templateUrl:"/templates/newGroupView.html"});n.when("/group/:id",{controller:"singleGroupController",templateUrl:"/templates/singleGroupView.html"});n.when("/group/:id/delete",{controller:"deleteGroupController",templateUrl:"/templates/groupsView.html"});n.when("/group/:id/newitem",{controller:"newItemController",templateUrl:"/templates/newItemView.html"});n.when("/item/:id/delete",{controller:"deleteItemController",templateUrl:"/templates/singleGroupView.html"});n.when("/group/:gid/edit/:iid",{controller:"singleItemController",templateUrl:"/templates/singleItemView.html"});n.when("/item/:id/newdetail",{controller:"newDetailController",templateUrl:"/templates/newDetailView.html"});n.when("/detail/:id/delete",{controller:"deleteDetailController",templateUrl:"/templates/singleItemView.html"});n.otherwise({redirectTo:"/"})}]);module.factory("dataService",["$http","$q",function(n,t){function r(n){var t=null;return $.each(i,function(i,r){if(r.id==n)return t=r,!1}),t}function c(n){var t=null;return $.each(f,function(i,r){if(r.id==n)return t=r,!1}),t}var i=[],f=[],u=!1,e=function(){return u},o=function(){var r=t.defer();return n.get("/api/v1/groups?includeItems=true").then(function(n){console.log(n);angular.copy(n.data,i);u=!0;r.resolve()},function(){r.reject()}),r.promise},s=function(i){var r=t.defer();return n.get("/api/v1/items/"+i).then(function(n){console.log(n);angular.copy(n.data,f);u=!0;r.resolve()},function(){r.reject()}),r.promise},h=function(r){var u=t.defer();return n.post("/api/v1/groups",r).then(function(n){var t=n.data;i.splice(0,0,t);u.resolve(t)},function(){u.reject()}),u.promise},l=function(n){var i=t.defer(),u;return e()?(u=r(n),u?i.resolve(u):i.reject()):o().then(function(){var t=r(n);t?i.resolve(t):i.reject()},function(){i.reject()}),i.promise},a=function(n,i){var r=t.defer();return s(n).then(function(){var n=c(i);n?r.resolve(n):r.reject()},function(){r.reject()}),r.promise},v=function(i){var r=t.defer();return n.put("/api/v1/groups",i).then(function(n){var t=n.data;r.resolve(t)},function(){r.reject()}),r.promise},y=function(i){var r=t.defer();return n.put("/api/v1/items",i).then(function(n){var t=n.data;r.resolve(t)},function(){r.reject()}),r.promise},p=function(u){var f=t.defer();return n.delete("/api/v1/groups/"+u).then(function(){var n=r(u),t=i.indexOf(n);i.splice(t,1);f.resolve()},function(){f.reject()}),f.promise},w=function(i){var u=t.defer();return n.post("/api/v1/items",i).then(function(n){console.log(n);var t=n.data,i=r(t.groupId);i.items.splice(0,0,t);u.resolve(t)},function(){u.reject()}),u.promise},b=function(i){var r=t.defer();return n.post("/api/v1/details",i).then(function(n){console.log(n);var t=n.data;r.resolve(t)},function(){r.reject()}),r.promise},k=function(r){var u=t.defer();return n.delete("/api/v1/items/"+r).then(function(){var e,n,t,f,o;for(console.log("groups collection before:"),console.log(i),e=0;e<i.length;e++)if(n=i[e],console.log("single group:"),console.log(n),n!=null){for(console.log("items in the current group:"),console.log(n.items),t=-1,f=0;f<n.items.length;f++)if(o=n.items[f],o!=null&&o.id==r){console.log("need to delete this item:");console.log(o);t=f;break}t!=-1&&(console.log("need to delete item with id = "+t),n.items.splice(t,1),console.log("updated items collection:"),console.log(n.items))}u.resolve()},function(){u.reject()}),u.promise},d=function(i){var r=t.defer();return n.delete("/api/v1/details/"+i).then(function(){r.resolve()},function(){r.reject()}),r.promise};return{groups:i,isReady:e,getGroups:o,addGroup:h,getGroupById:l,editGroup:v,deleteGroupById:p,addItem:w,deleteItemById:k,getItemById:a,editItem:y,addDetail:b,deleteDetailById:d}}]);var groupsController=["$scope","$http","dataService",function(n,t,i){n.data=i;n.isBusy=!1;i.isReady()==!1&&(n.isBusy=!0,i.getGroups().then(function(){},function(){alert("could not load groups")}).then(function(){n.isBusy=!1}))}],newGroupController=["$scope","$http","$window","dataService",function(n,t,i,r){n.newGroup={};n.save=function(){r.addGroup(n.newGroup).then(function(){i.location="#/"},function(){alert("could not save the new group")})}}],singleGroupController=["$scope","dataService","$window","$routeParams",function(n,t,i,r){n.group=null;t.getGroupById(r.id).then(function(t){n.group=t;console.log(t)},function(){i.location="#/"});n.editGroup=function(){console.log(n.group);t.editGroup(n.group).then(function(){},function(){alert("Could not update group")})}}],deleteGroupController=["$scope","dataService","$window","$routeParams",function(n,t,i,r){t.deleteGroupById(r.id).then(function(){i.location="#/"},function(){i.location="#/"})}],newItemController=["$scope","$http","$window","dataService","$routeParams",function(n,t,i,r,u){n.newItem={};n.save=function(){n.newItem.groupId=u.id;r.addItem(n.newItem).then(function(){i.location="#/group/"+u.id},function(){alert("could not save the new item")})}}],deleteItemController=["$scope","dataService","$window","$routeParams",function(n,t,i,r){t.deleteItemById(r.id).then(function(){i.location="#/"},function(){i.location="#/"})}],singleItemController=["$scope","dataService","$window","$routeParams",function(n,t,i,r){n.item=null;var u=r.gid,f=r.iid;t.getItemById(u,f).then(function(t){n.item=t;console.log(t)},function(){i.location="#/"});n.editItem=function(){console.log("Updated item:");console.log(n.item);t.editItem(n.item).then(function(){},function(){alert("Could not update item")})}}],newDetailController=["$scope","$http","$window","dataService","$routeParams",function(n,t,i,r,u){n.newDetail={};n.save=function(){n.newDetail.itemId=u.id;r.addDetail(n.newDetail).then(function(){i.location="#/"},function(){alert("could not save the new detail")})}}],deleteDetailController=["$scope","dataService","$window","$routeParams",function(n,t,i,r){t.deleteDetailById(r.id).then(function(){i.location="#/"},function(){i.location="#/"})}];
/*
//# sourceMappingURL=moderate-index.min.js.map
*/